// Egg Hunter (20 bytes) Test
//   - searches from current addr towards lower memory
//   - marker: 0x5159 (push ecx,pop ecx)
// Paw Petersen, SLAE-656
// https://www.pawpetersen.dk/slae-assignment-3-egg-hunter-linux-x86/

#include <stdio.h>
#include <string.h>
#include <stdlib.h>

unsigned char egghunter[20];

void main()
{
	unsigned char shellcode[256] = \
"\x90\x51\x59\x68\x21\x0a\x0a\x0a\x68\x20\x65\x67\x67\x68\x20\x74\x68"
"\x65\x68\x6f\x75\x6e\x64\x68\x57\x65\x20\x66\x31\xc9\xb1\x12\x51\xb8"
"\x11\x11\x51\x08\x50\x31\xc0\x50\x54\x51\x89\xe6\x83\xc6\x14\x03\x74"
"\x24\x10\x2b\x34\x24\x56\x89\xf1\xeb\x1c\xeb\x0c\x59\x59\xe2\xe8\x31"
"\xdb\x31\xc0\xb0\x01\xcd\x80\x31\xc0\xb0\xa2\x8d\x5c\x24\x0c\x31\xc9"
"\xcd\x80\xeb\xe6\x31\xd2\xb2\x01\x31\xdb\xb3\x01\x31\xc0\xb0\x04\xcd"
"\x80\xeb\xd4";	

	printf("Shellcode: %d bytes\n", strlen(shellcode));

	strcpy(egghunter,"\xeb\x0d\x59\x83\xe9\x17\x66\x81\x39\x51\x59\xe0"
"\xf9\xff\xe1\xe8\xee\xff\xff\xff");

  printf("Egghunter: %d bytes\n", strlen(egghunter));

	int (*ret)() = (int(*)())egghunter;
 
	ret();
}
